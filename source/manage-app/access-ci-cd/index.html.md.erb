---
title: How apps are deployed
weight: 42
last_reviewed_on: 2022-02-01
review_in: 6 months
---

# How apps are deployed

We deploy a GOV.UK app to the GOV.UK Kubernetes platform as a set of [Kubernetes resources](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/).

A Kubernetes resource is a piece of configuration that tells Kubernetes how to run a GOV.UK app in the Kubernetes cluster.

We manage these Kubernetes resources using [Helm](https://helm.sh/), more specifically [Helm charts](https://helm.sh/docs/topics/charts/).

Helm charts define a group of Kubernetes resources. We use Helm charts to deploy GOV.UK apps to the GOV.UK Kubernetes platform as a set of Kubernetes resources.

We define and store GOV.UK app Helm charts in the [`govuk-helm-charts` repo](https://github.com/alphagov/govuk-helm-charts).

## How ArgoCD works

We use [ArgoCD](https://argo-cd.readthedocs.io/en/stable/) to manage the app deployment.

ArgoCD continuously monitors Kubernetes and the `govuk-helm-charts` repo to make sure they stay in sync.

ArgoCD uses Argo applications to represent each of the GOV.UK apps.

These Argo apps represent the Helm chart and associated Kubernetes resources for the GOV.UK apps.

Each of these Argo apps is managed by another Argo app in a nested structure.

When ArgoCD updates Kubernetes resources, ArgoCD uses Helm to apply any changes and deploy the Helm charts.

## Deploying a new release of a GOV.UK app

The following content states what happens when a user deploys a new release of a GOV.UK app on the GOV.UK Kubernetes platform.

This specific example is what happens when you update an [image tag](https://helm.sh/docs/topics/charts/#tags-and-condition-fields-in-dependencies) in a Helm chart in the `govuk-helm-charts` repo.

ArgoCD logs the difference between the image tag in the repo and the equivalent image tag in the Helm chart deployment resource in the Kubernetes cluster.

ArgoCD updates the image tag in the cluster's deployment resource.

This update triggers [Kubernetes to deploy the updated GOV.UK app](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment).

Once Kubernetes deploys the app, ArgoCD runs a [post sync hook](https://argo-cd.readthedocs.io/en/stable/user-guide/resource_hooks/) to run [smokey tests](https://github.com/alphagov/smokey) for the app.

## Continuous deployment of a new release of a GOV.UK app

The Continuous Deployment (CD) process is an automatic deployment process, and is triggered by a new release of a GOV.UK app.

A release is a tagged commit that represents a deployable version of the code for a GOV.UK app.

When a user creates a new release, the Continuous Integration (CI) tool, currently GitHub Actions, builds the new image and pushes that new image to AWS elastic container repository (ECR).

CI then updates the image tag value in the [govuk-helm-charts repo integration folder](https://github.com/alphagov/govuk-helm-charts/tree/main/charts/argocd-apps/image-tags/integration) for the new release.

ArgoCD notices that the image tag is now different, and automatically deploys the new release to the [integration environment](https://github.com/alphagov/govuk-helm-charts/tree/main/charts/argocd-apps/image-tags/integration). This triggers smokey tests for the app.

If the smokey tests are successful in integration, this triggers an ArgoCD workflow to update the image tag for the next environment. ArgoCD promotes the release to the [staging environment](https://github.com/alphagov/govuk-helm-charts/tree/main/charts/argocd-apps/image-tags/staging), which triggers further smokey tests.

If the smokey tests are successful in staging, ArgoCD promotes the release to the [production environment](https://github.com/alphagov/govuk-helm-charts/tree/main/charts/argocd-apps/image-tags/production), which triggers further smokey tests.

If the smokey tests are successful in production, then ArgoCD deploys the release.

When ArgoCD updates the image tag value, it creates and merges a branch into the main branch for the `govuk-helm-charts` repo without any review.

Join the [#govuk-deploy-alerts Slack channel](https://gds.slack.com/archives/C01EE7US9R6) to get a notification when an app is deployed and whether the deployment succeeded or failed.

If your app deployment failed, you should check the Argo CD logs to see why.

## Check the Argo CD logs

You must sign into Argo CD to view the Argo CD logs.

The environment you need to sign into depends on where the app deployment failed.

### Check the Argo CD integration environment

If your app deployment failed in integration, sign into the [Argo CD integration environment](https://argo.eks.integration.govuk.digital/) using your GitHub account.

To sign into integration, your GitHub account must be part of the [GOV.UK team on alphagov](https://github.com/orgs/alphagov/teams/gov-uk).

### Check the Argo CD staging and production environments

If your app deployment failed in integration or production, sign into the [Argo CD staging environment](https://argo.eks.staging.govuk.digital/) or [Argo CD production environment](https://argo.eks.production.govuk.digital/) using your GitHub account.

To sign into staging or production, your GitHub account must be part of the [GOV.UK production team on alphagov](https://github.com/orgs/alphagov/teams/gov-uk-production).

See the [documentation on getting production access](https://docs.publishing.service.gov.uk/manual/rules-for-getting-production-access.html) for more information.
